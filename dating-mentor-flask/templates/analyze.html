
{% extends "base.html" %}

{% block title %}Анализ - ИИ-Ментор для дейтинга{% endblock %}

{% block content %}
<div class="container py-5">
    <h1 class="text-center mb-5">
        <i class="fas fa-analyze"></i> Инструменты анализа
    </h1>
    
    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs nav-fill mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-tab" type="button">
                <i class="fas fa-user-check"></i> Анализ анкеты
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#examples-tab" type="button">
                <i class="fas fa-comment-dots"></i> Примеры сообщений
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#photo-tab" type="button">
                <i class="fas fa-camera"></i> Советы по фото
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#grammar-tab" type="button">
                <i class="fas fa-spell-check"></i> Проверка текста
            </button>
        </li>
    </ul>
    
    <!-- Tab Content -->
    <div class="tab-content">
        <!-- Profile Analysis Tab -->
        <div class="tab-pane fade show active" id="profile-tab" role="tabpanel">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title mb-4">
                                <i class="fas fa-user-check text-success"></i> Анализ вашей анкеты
                            </h3>
                            
                            <form id="profileAnalysisForm">
                                <!-- File Upload -->
                                <div class="mb-4">
                                    <label class="form-label">Загрузите скриншот анкеты</label>
                                    <div class="file-upload-area" id="fileUploadArea">
                                        <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                        <p class="mb-1">Перетащите изображение сюда или нажмите для выбора</p>
                                        <small class="text-muted">Поддерживаются: PNG, JPG, JPEG (до 16MB)</small>
                                    </div>
                                    <input type="file" id="profileImage" name="file" accept="image/*" hidden>
                                    <div id="fileInfo" class="mt-2"></div>
                                </div>
                                
                                <div class="text-center mb-3">
                                    <span class="badge bg-secondary">ИЛИ</span>
                                </div>
                                
                                <!-- Text Input -->
                                <div class="mb-4">
                                    <label class="form-label">Введите текст анкеты вручную</label>
                                    <textarea class="form-control" id="profileText" name="text" rows="6"
                                              placeholder="Скопируйте и вставьте текст вашей анкеты здесь..."></textarea>
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fas fa-robot"></i> Анализировать анкету
                                </button>
                            </form>
                            
                            <!-- Results -->
                            <div id="analysisResults" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Examples Tab -->
        <div class="tab-pane fade" id="examples-tab" role="tabpanel">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title mb-4">
                                <i class="fas fa-comment-dots text-info"></i> Генератор примеров сообщений
                            </h3>
                            
                            <div class="mb-4">
                                <label class="form-label">Выберите контекст</label>
                                <select class="form-select" id="exampleContext">
                                    <option value="general">Общие знакомства</option>
                                    <option value="dating_app">Приложения знакомств (Tinder, Bumble)</option>
                                    <option value="social_media">Социальные сети (Instagram, VK)</option>
                                    <option value="professional">Деловые знакомства</option>
                                </select>
                            </div>
                            
                            <button class="btn btn-primary btn-lg w-100" id="generateExamplesBtn">
                                <i class="fas fa-magic"></i> Сгенерировать примеры
                            </button>
                            
                            <!-- Results -->
                            <div id="examplesResults" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Photo Tips Tab -->
        <div class="tab-pane fade" id="photo-tab" role="tabpanel">
            <div class="row">
                <div class="col-lg-10 mx-auto">
                    <div id="photoAdviceContent">
                        <div class="text-center mb-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Загрузка...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Grammar Check Tab -->
        <div class="tab-pane fade" id="grammar-tab" role="tabpanel">
            <div class="row">
                <div class="col-lg-8 mx-auto">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title mb-4">
                                <i class="fas fa-spell-check text-warning"></i> Проверка грамматики и стиля
                            </h3>
                            
                            <div class="mb-4">
                                <label class="form-label">Введите текст для проверки</label>
                                <textarea class="form-control" id="grammarText" rows="8"
                                          placeholder="Вставьте сюда текст сообщения или описания для проверки..."></textarea>
                            </div>
                            
                            <button class="btn btn-primary btn-lg w-100" id="checkGrammarBtn">
                                <i class="fas fa-spell-check"></i> Проверить
                            </button>
                            
                            <!-- Results -->
                            <div id="grammarResults" class="mt-4"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.nav-tabs .nav-link {
    color: var(--dark-color);
    font-weight: 500;
    padding: 1rem 1.5rem;
    border: none;
    background: transparent;
}

.nav-tabs .nav-link:hover {
    color: var(--primary-color);
    border: none;
}

.nav-tabs .nav-link.active {
    color: var(--primary-color);
    background: transparent;
    border: none;
    border-bottom: 3px solid var(--primary-color);
}

.correction-item {
    background: #FEF3C7;
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1rem;
    border-left: 4px solid var(--warning-color);
}

.grammar-results {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}
</style>

<script>
// Load photo advice when tab is shown
document.querySelector('button[data-bs-target="#photo-tab"]').addEventListener('shown.bs.tab', async function () {
    const container = document.getElementById('photoAdviceContent');
    
    try {
        const result = await API.getPhotoAdvice();
        if (result.success) {
            container.innerHTML = result.advice;
        } else {
            container.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-circle"></i> Не удалось загрузить советы
                </div>
            `;
        }
    } catch (error) {
        container.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-exclamation-circle"></i> Ошибка загрузки
            </div>
        `;
    }
});

// Check if we need to open a specific tab
if (window.location.hash === '#photo-tips') {
    const photoTab = document.querySelector('button[data-bs-target="#photo-tab"]');
    if (photoTab) {
        const tab = new bootstrap.Tab(photoTab);
        tab.show();
    }
}
</script>
{% endblock %}
